<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Randevu Al - Cep Teknik</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
 <link rel="icon" type="image/png" href="CepTeknik.png" />
<style>
    .footeryazi{
        color: #ffffff;
    }
    #time{
         color: rgb(148, 4, 4);
    }
    #device {
        color: rgb(148, 4, 4);
    }
:root {
  --bg: #0b0b0b;
  --accent: #b8860b;
  --muted: rgba(255,255,255,0.03);
  
}
body { background: var(--bg); color: #eee; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif; margin:0; padding-top:70px;}
.navbar { backdrop-filter: blur(6px); background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-bottom: 1px solid rgba(255,255,255,0.03);}
.brand-accent { color: var(--accent); font-weight:700; }
.btn-accent { background: var(--accent); color: #0b0b0b; border: none; font-weight: 600;}
.btn-accent:hover { background: #ffd700; }
.container-form { max-width: 820px; margin: 3rem auto; padding: 2rem; }
.card-dark { background: rgba(20,20,20,0.9); border-radius: 12px; padding: 2rem; box-shadow: 0 8px 20px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.03);}
label { color: rgba(255,255,255,0.9); font-weight:600; }
input, textarea, select { width:100%; padding:.65rem .75rem; margin-top:.35rem; margin-bottom:1rem; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background: var(--muted); color:#fff;}
input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.55); }
.row-gap { gap:1rem; display:grid; grid-template-columns:1fr 1fr;}
@media(max-width:768px){ .row-gap{ grid-template-columns:1fr;} }
.note { color: rgba(255,255,255,0.7); font-size:.95rem; margin-bottom:.5rem; text-align:center;}
.success-msg, .error-msg { display:none; padding:.75rem 1rem; border-radius:8px; margin-bottom:1rem;}
.success-msg { background: rgba(40,120,40,0.12); color:#b8ffb8; border:1px solid rgba(40,120,40,0.2);}
.error-msg { background: rgba(200,40,40,0.08); color:#ffb8b8; border:1px solid rgba(200,40,40,0.12);}
footer { padding:2.2rem 0; text-align:center; color: rgba(255,255,255,0.7); border-top:1px solid rgba(255,255,255,0.02); margin-top:3rem; }
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg fixed-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
      <div style="width:44px;height:44px;border-radius:8px;background:var(--accent);display:flex;align-items:center;justify-content:center;color:#0b0b0b;font-weight:700">
        <img src="CepTeknik.png" alt="Logo" style="max-width:100%;max-height:100%;border-radius:8px">
      </div>
      <div>
        <div class="brand-accent">Cep Teknik</div>
        <small id="alt-baslik" style="color:#fff;opacity:.9">Telefon & Tamir</small>
      </div>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu">
      <span class="navbar-toggler-icon" style="filter: invert(1)"></span>
    </button>
   
  </div>
</nav>

<div class="container container-form">
  <div class="card-dark">
    <h1 style="text-align:center;margin-bottom:.25rem">Randevu Seç</h1>
    <p class="note">İstediğiniz tarih ve saati seçin. Form gönderildikten sonra size dönüş yapılacaktır.</p>
    <div id="success" class="success-msg">Randevunuz başarıyla gönderildi. Kısa süre içinde geri dönüş yapılacaktır.</div>
    <div id="error" class="error-msg">Randevu gönderilemedi. Lütfen daha sonra tekrar deneyin.</div>
    <form id="randevuForm" action="https://formspree.io/f/mvgqylrp" method="POST" novalidate>
      <div class="row-gap">
        <div>
          <label for="name">Ad Soyad *</label>
          <input id="name" name="name" type="text" placeholder="Adınızı ve soyadınızı girin" required>
        </div>
        <div>
          <label for="phone">Telefon *</label>
          <input id="phone" name="phone" type="tel" placeholder="05xx xxx xx xx" required>
        </div>
      </div>

      <label for="email">E-posta</label>
      <input id="email" name="_replyto" type="email" placeholder="ornek@eposta.com">

      <div class="row-gap">
        <div>
          <label for="date">Tarih *</label>
          <input id="date" name="date" type="date" required>
        </div>
        <div>
          <label for="time">Saat *</label>
          <select id="time" name="time" required>
            <option value="">Saat Seçin</option>
            <option>10:00</option>
            <option>10:30</option>
            <option>11:00</option>
            <option>11:30</option>
            <option>12:00</option>
            <option>12:30</option>
            <option>13:00</option>
            <option>13:30</option>
            <option>14:00</option>
            <option>14:30</option>
            <option>15:00</option>
            <option>15:30</option>
            <option>16:00</option>
            <option>16:30</option>
            <option>17:00</option>
            <option>17:30</option>
            <option>18:00</option>
          </select>
        </div>
      </div>

      <label for="device">Arızalı Cihaz</label>
      <select id="device" name="device">
        <option>Telefon</option>
        <option>Tablet</option>
        <option>Bilgisayar</option>
        <option>Akıllı Saat</option>
        <option>AirPods</option>
        <option>Diğer(Ek notda belirtiniz)</option>
      </select>

      <label for="notes">Ek Not (kısa açıklama)</label>
      <textarea id="notes" name="message" rows="4" placeholder="Sorunun kısa açıklaması..."></textarea>

      <input type="hidden" name="_subject" value="Yeni Randevu Talebi - Cep Teknik">

      <div style="text-align:center;margin-top:1rem;">
        <button id="submitBtn" type="submit" class="btn btn-accent">Randevu Gönder</button>
        <a href="index.html" class="btn" style="margin-left: .5rem; border:1px solid rgba(255,255,255,0.06); color:#fff; background:transparent;">İptal / Ana Sayfa</a>
      </div>
    </form>
    <p class="note" style="margin-top:1rem">Not: Tarih olarak bugünden sonrası seçilebilir.</p>
  </div>
</div>

<footer><strong class="footeryazi">Cep Teknik</strong> © <span id="yr"></span></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// --- Ay: footer yılını güncelle (eğer var) ---
const yrEl = document.getElementById('yr');
if(yrEl) yrEl.textContent = new Date().getFullYear();

// --- 1) Min tarih = bugün (date input için) ---
(function setMinDate() {
  const dateInput = document.getElementById('date');
  if (!dateInput) return;
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,'0');
  const dd = String(today.getDate()).padStart(2,'0');
  dateInput.min = `${yyyy}-${mm}-${dd}`;
})();

// --- 2) Saat slotlarını otomatik oluştur (10:00 - 18:00, yarım saatlik) ---
(function populateTimeSlots(){
  const timeSelect = document.getElementById('time');
  if (!timeSelect) return;
  // reset
  timeSelect.innerHTML = '<option value="">Saat Seçin</option>';

  const startHour = 10;
  const endHour = 18;
  const step = 30; // dakika

  for(let h = startHour; h <= endHour; h++){
    for(let m = 0; m < 60; m += step){
      // 18:30 gibi bir slotu ekleme
      if (h === endHour && m > 0) continue;
      const hh = String(h).padStart(2, '0');
      const mmStr = String(m).padStart(2, '0');
      const option = document.createElement('option');
      option.value = `${hh}:${mmStr}`;
      option.textContent = `${hh}:${mmStr}`;
      timeSelect.appendChild(option);
    }
  }
})();

// --- 3) Tarih seçildiğinde hafta sonunu engelle ---
(function setupDateValidation(){
  const dateInput = document.getElementById('date');
  if (!dateInput) return;
  dateInput.addEventListener('input', function() {
    if (!this.value) return;
    const selected = new Date(this.value + 'T00:00'); // timezone safe
    const day = selected.getDay(); // 0 = Pazar, 6 = Cumartesi
    if (day === 0 || day === 6) {
      alert('Lütfen Pazartesi–Cuma arası bir tarih seçin.');
      this.value = '';
    }
  });
})();

// --- 4) Form submit: Formspree'ye fetch ile gönder ve .ics üretip index'e yönlendir ---
(function setupFormSubmit(){
  const form = document.getElementById('randevuForm');
  if (!form) return;

  const successBox = document.getElementById('success');
  const errorBox = document.getElementById('error');
  const submitBtn = document.getElementById('submitBtn');

  form.addEventListener('submit', function(e){
    e.preventDefault();

    // Basit client-side kontrol
    const name = (document.getElementById('name')?.value || '').trim();
    const phone = (document.getElementById('phone')?.value || '').trim();
    const date = document.getElementById('date')?.value;
    const time = document.getElementById('time')?.value;

    if (!name || !phone || !date || !time) {
      if (errorBox) {
        errorBox.textContent = 'Lütfen zorunlu alanları doldurun (Ad, Telefon, Tarih, Saat).';
        errorBox.style.display = 'block';
      } else {
        alert('Lütfen zorunlu alanları doldurun (Ad, Telefon, Tarih, Saat).');
      }
      if (successBox) successBox.style.display = 'none';
      return;
    }

    // UI değişiklikleri: butonu disable et
    submitBtn.disabled = true;
    submitBtn.textContent = 'Gönderiliyor...';

    // FormData hazırla ve gönder
    const formData = new FormData(form);

    fetch(form.action, {
      method: form.method || 'POST',
      body: formData,
      headers: { 'Accept': 'application/json' }
    }).then(async response => {
      submitBtn.disabled = false;
      submitBtn.textContent = 'Randevu Gönder';

      if (response.ok) {
        // başarılı
        if (successBox) {
          successBox.style.display = 'block';
          successBox.textContent = 'Randevunuz başarıyla gönderildi. Kısa süre içinde dönüş yapılacaktır.';
        } else {
          alert('Randevunuz başarıyla gönderildi.');
        }
        if (errorBox) errorBox.style.display = 'none';

        // ICS oluştur ve indir (isteğe bağlı)
        try {
          createICS(date, time, name);
        } catch (err) {
          console.warn('ICS oluşturulamadı:', err);
        }

        // kısa bekleyip ana sayfaya yönlendir
        setTimeout(()=> { window.location.href = 'CepTeknik.html'; }, 1800);
      } else {
        // hata: Formspree hata objesi dönebilir
        let msg = 'Mesaj gönderilemedi. Lütfen tekrar deneyin.';
        try {
          const data = await response.json();
          if (data && data.error) msg = data.error;
        } catch(_) {}
        if (errorBox) {
          errorBox.textContent = msg;
          errorBox.style.display = 'block';
        } else {
          alert(msg);
        }
        if (successBox) successBox.style.display = 'none';
      }
    }).catch(err => {
      console.error(err);
      submitBtn.disabled = false;
      submitBtn.textContent = 'Randevu Gönder';
      const msg = 'Ağ hatası. Lütfen internet bağlantınızı kontrol edip tekrar deneyin.';
      if (errorBox) {
        errorBox.textContent = msg;
        errorBox.style.display = 'block';
      } else {
        alert(msg);
      }
      if (successBox) successBox.style.display = 'none';
    });
  });
})();

// --- 5) .ics (iCalendar) oluşturma fonksiyonları ---
function createICS(dateStr, timeStr, name) {
  // dateStr: yyyy-mm-dd, timeStr: HH:MM
  // oluşturulan etkinlik 30 dakika varsayıyor
  const start = new Date(dateStr + 'T' + timeStr);
  const end = new Date(start.getTime() + 30 * 60000); // +30dk

  const icsLines = [
    'BEGIN:VCALENDAR',
    'VERSION:2.0',
    'PRODID:-//Cep Teknik//Randevu//TR',
    'CALSCALE:GREGORIAN',
    'BEGIN:VEVENT',
    `UID:${generateUID()}`,
    `DTSTAMP:${formatICSDate(new Date())}`,
    `DTSTART:${formatICSDate(start)}`,
    `DTEND:${formatICSDate(end)}`,
    `SUMMARY:Randevu - ${escapeICSText(name)}`,
    `DESCRIPTION:Randevu talebi - Cep Teknik`,
    `LOCATION:Cep Teknik`,
    'END:VEVENT',
    'END:VCALENDAR'
  ];

  const blob = new Blob([icsLines.join('\r\n')], { type: 'text/calendar;charset=utf-8' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'randevu.ics';
  document.body.appendChild(a);
  a.click();
  setTimeout(()=> { URL.revokeObjectURL(url); a.remove(); }, 1000);
}

function formatICSDate(d){
  // UTC format without punctuation: 20250813T153000Z (we'll use local time converted to UTC)
  const yyyy = d.getUTCFullYear();
  const mm = String(d.getUTCMonth()+1).padStart(2,'0');
  const dd = String(d.getUTCDate()).padStart(2,'0');
  const hh = String(d.getUTCHours()).padStart(2,'0');
  const mi = String(d.getUTCMinutes()).padStart(2,'0');
  const ss = String(d.getUTCSeconds()).padStart(2,'0');
  return `${yyyy}${mm}${dd}T${hh}${mi}${ss}Z`;
}

function generateUID(){
  return 'randevu-' + Date.now() + '-' + Math.random().toString(36).slice(2,9);
}

function escapeICSText(txt){
  return (txt || '').replace(/,/g,'\\,').replace(/;/g,'\\;').replace(/\n/g,'\\n');
}
</script>

</body>
</html>


